<!DOCTYPE html>
<html>
    <head>
        <title>CARDS</title>
        <link rel="stylesheet" href="styles.css">
        <link rel="stylesheet" href="../eReceipt/jquery-ui-1.12.1/jquery-ui.min.css">
        <link rel="stylesheet" href="../eReceipt/jquery-ui-1.12.1/jquery-ui.structure.min.css">
        <link rel="stylesheet" href="../eReceipt/jquery-ui-1.12.1/jquery-ui.theme.min.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    </head>
    <body>
        <div class="top">
            <p><h2>Player 1's turn</h2></p>
        </div>

            <section>
            <div id="computer" class="clearfix">

            </div>


            <div id="center" class="clearfix">
                <div id="market" ><p></p>  <span>whot</span></div>
                <div id="twenty">
                    <div class="a" id="square"><div><i class="fas fa-square" style="font-size: 20px; color:#521717;  "></i></div></div>
                    <div class="a" id="star"><div><i class="fas fa-star" style="font-size: 20px; color:#521717;  "></i></div></div>
                    <div class="a" id="circle"><div><i class="fas fa-circle" style="font-size: 20px; color:#521717;  "></i></div></div>
                    <div class="a" id="cross"><div><i class="fas fa-cross" style="font-size: 20px; color:#521717;  "></i></div></div>
                    <div class="a" id="triangle"><div><i class="fas fa-play" style="font-size: 20px; color:#521717;  "></i></div></div>

                </div>

            </div>

            <div id="player">

            </div>

        </section>


        <script src="../eReceipt/jquery-3.5.1.min.js"></script>
        <script src="../eReceipt/jquery-ui-1.12.1/jquery-ui.min.js"></script>
        <script>
            $(function () {
                // available card contains the number of cards available in the deck of card at any specific time
                var availableCard = [
                    {
                        number: 1,
                        shape: "circle"
                    },
                    {
                        number: 1,
                        shape: "triangle"
                    },
                    {
                        number: 1,
                        shape: "cross"
                    },
                    {
                        number: 1,
                        shape: "square"
                    },
                    {
                        number: 1,
                        shape: "star"
                    },
                    {
                        number: 2,
                        shape: "circle"
                    },
                    {
                        number: 2,
                        shape: "triangle"
                    },
                    {
                        number: 2,
                        shape: "cross"
                    },
                    {
                        number: 2,
                        shape: "square"
                    },
                    {
                        number: 2,
                        shape: "star"
                    },
                    {
                        number: 3,
                        shape: "circle"
                    },
                    {
                        number: 3,
                        shape: "triangle"
                    },
                    {
                        number: 3,
                        shape: "cross"
                    },
                    {
                        number: 3,
                        shape: "square"
                    },
                    {
                        number: 3,
                        shape: "star"
                    },
                    {
                        number: 4,
                        shape: "circle"
                    },
                    {
                        number: 4,
                        shape: "triangle"
                    },
                    {
                        number: 4,
                        shape: "star"
                    },
                    {
                        number: 5,
                        shape: "circle"
                    },
                    {
                        number: 5,
                        shape: "triangle"
                    },
                    {
                        number: 5,
                        shape: "cross"
                    },
                    {
                        number: 5,
                        shape: "square"
                    },
                    {
                        number: 5,
                        shape: "star"
                    },
                    {
                        number: 7,
                        shape: "circle"
                    },
                    {
                        number: 7,
                        shape: "triangle"
                    },
                    {
                        number: 7,
                        shape: "cross"
                    },
                    {
                        number: 7,
                        shape: "square"
                    },
                    {
                        number: 7,
                        shape: "star"
                    },
                    {
                        number: 8,
                        shape: "circle"
                    },
                    {
                        number: 8,
                        shape: "triangle"
                    },
                    {
                        number: 8,
                        shape: "star"
                    },
                    {
                        number: 10,
                        shape: "circle"
                    },
                    {
                        number: 10,
                        shape: "triangle"
                    },
                    {
                        number: 10,
                        shape: "cross"
                    },
                    {
                        number: 10,
                        shape: "square"
                    },
                    {
                        number: 11,
                        shape: "circle"
                    },
                    {
                        number: 11,
                        shape: "triangle"
                    },
                    {
                        number: 11,
                        shape: "cross"
                    },
                    {
                        number: 11,
                        shape: "square"
                    },
                    {
                        number: 12,
                        shape: "circle"
                    },
                    {
                        number: 12,
                        shape: "triangle"
                    },
                    {
                        number: 13,
                        shape: "circle"
                    },
                    {
                        number: 13,
                        shape: "triangle"
                    },
                    {
                        number: 13,
                        shape: "cross"
                    },
                    {
                        number: 13,
                        shape: "square"
                    },
                    {
                        number: 14,
                        shape: "circle"
                    },
                    {
                        number: 14,
                        shape: "triangle"
                    },
                    {
                        number: 14,
                        shape: "cross"
                    },
                    {
                        number: 14,
                        shape: "square"
                    },
                    {
                        number: 20,
                        shape: "whot"
                    },
                    {
                        number: 20,
                        shape: "whot"
                    },
                    {
                        number: 20,
                        shape: "whot"
                    },
                    {
                        number: 20,
                        shape: "whot"
                    }
                ]

                var twoCount = false
                var fiveCount = false
                var whotShape = 0

                // current player 1 for player, 0 for computer
                var currentPlayer = 1

                // Cards already played
                var played = []

                var computerCAS = []
                var playerCAS = 0


                // The dashCards functions calls on the pick function 'number' number of times to dash out cards to a particulay player
                function dashCards(number, player) {
                    for (i = 0; i<number; i++){
                        pick(player)
                    }
                }

                dashCards(5, 0)
                dashCards(5, 1)
                dashCards(1)
                // console.log(computerCAS)
                // The pick function picks a random card from the availableCard array
                function pick(n) {
                    if (availableCard.length == 0) {
                        availableCard = played
                        played = []
                    } else {
                        var r =  Math.floor(Math.random() * availableCard.length)
                        render(r, n)
                    }
                }



                // The render function takes in the index number of the random generated number and the currentPlayer and display cards for each player
                function render(re, z) {
                    if (availableCard[re] == undefined) {
                        console.log(availableCard[re])
                        pick(n)
                    } else {
                        let cardNum = availableCard[re]['number']
                        let cardShape = availableCard[re]['shape']
                        var div;
                        var x ;
                        var s = 'fas fa-square'
                        var t = 'fas fa-play'
                        var c = 'fas fa-circle'
                        var st = 'fas fa-star'
                        var w = 'fas fa-whot'
                        var cr = 'fas fa-cross'
                        var shapes;

                        if (cardShape == 'square'){
                            shapes = s
                        }else if (cardShape == 'triangle'){
                            shapes = t
                        }else if (cardShape == 'circle'){
                            shapes = c
                        }else if (cardShape == 'star'){
                            shapes = st
                        }else if (cardShape == 'cross'){
                            shapes = cr
                        } else {
                            shapes = w
                        }


                        if (z == 0) {
                            x = '#computer'
                            computerCAS.push(availableCard[re])

                            div = `<div class="ndraggable" style="height: 250px; width: 200px; background-color: wheat; position: relative;"><p style="color:#521717; font-weight: bolder; font-size: xx-large;">${cardNum}</p><span>${cardShape}</span><div style="position: absolute; top: 33px; left: 7px; " > <i class="${shapes}" style="font-size: 20px; color:#521717;"></i></div><div  style="position: absolute; top: 70px; left: 50px; " > <i class="${shapes}" style="font-size: 100px; color:#521717;  "></i></div><div style="position: absolute; bottom: 4px; right: 4px; " > <i class="${shapes}" style="font-size: 20px; color:#521717;"></i></div></div>`
                        } else if (z == 1) {
                            x = '#player'
                            playerCAS++
                            div = `<div class="draggable" style="height: 250px; width: 200px; background-color: wheat; position: relative;"><p style="color:#521717; font-weight: bolder; font-size: xx-large;">${cardNum}</p><span>${cardShape}</span><div style="position: absolute; top: 33px; left: 7px; " > <i class="${shapes}" style="font-size: 20px; color:#521717;"></i></div><div  style="position: absolute; top: 70px; left: 50px; " > <i class="${shapes}" style="font-size: 100px; color:#521717;  "></i></div><div style="position: absolute; bottom: 32px; right: 12px; " > <i class="${shapes}" style="font-size: 20px; color:#521717; "></i></div></div>`
                        } else {
                            x = '#center'
                            div = `<div id="droppable" style="height: 250px; width: 200px; background-color: wheat; position: relative;"><p style="color:#521717; font-weight: bolder; font-size: xx-large;">${cardNum}</p><span>${cardShape}</span><div style="position: absolute; top: 33px; left: 7px; " > <i class="${shapes}" style="font-size: 20px; color:#521717;"></i></div><div  style="position: absolute; top: 70px; left: 50px; " > <i class="${shapes}" style="font-size: 100px; color:#521717;  "></i></div><div style="position: absolute; bottom: 32px; right: 12px; " > <i class="${shapes}" style="font-size: 20px; color:#521717; "></i></div></div>`
                        }
                        $(x).append(div)


                            $('.draggable').draggable({
                                revert: true
                            })


                        availableCard.splice(re, 1)
                    }
                }
                $('.draggable').draggable()
                $('#droppable').droppable(
                    {
                        drop: function(event, ui){
                            var draggedNum = $(ui.draggable).find('p').text()
                            var draggedSha = $(ui.draggable).find('span').text()
                            var v = dropCheck(draggedNum, draggedSha)
                            if (v == true) {
                                $(this).html($(ui.draggable.html()))
                                var obj = {
                                    number: draggedNum,
                                    shape: draggedSha
                                }
                                played.push(obj)
                                $(ui.draggable).css('display', 'none')
                                if (draggedNum == 2) {
                                    passTurn()
                                } else if (draggedNum == 5) {
                                    passTurn()
                                } else if (draggedNum == 14) {
                                    twoCount = false
                                    fiveCount = false
                                    currentPlayer = 0
                                    dashCards(1, currentPlayer)
                                    $('h2').text(mes[10])
                                    passTurn()
                                } else if (draggedNum == 8) {
                                    twoCount = false
                                    fiveCount = false
                                    currentPlayer = 0
                                    passTurn()
                                } else if (draggedNum == 20) {
                                    twoCount = false
                                    fiveCount = false
                                    twenty()
                                } else {
                                    twoCount = false
                                    fiveCount = false
                                    passTurn()
                                }
                                playerCAS--
                                if (playerCAS == 1){
                                    $('h2').text(mes[9])
                                }
                            }
                        }
                    }
                )



                function dropCheck(p, span) {
                    var dropNum = $('#droppable').find('p').text()
                    var dropSha = $('#droppable').find('span').text()
                    if (dropNum == 2 && twoCount == true) {
                        if(p == 2) {
                            twoCount = false
                            return true
                        } else {
                            return false
                        }
                    } else if (dropNum == 5 && fiveCount == true) {
                        if (p == 5) {
                            fiveCount = false
                            return true
                        } else {
                            return false
                        }
                    } else if (dropNum == 8){
                        return true
                    } else if (dropNum == 20) {
                        if (p == 20 || span == whotShape){
                            whotShape = ''
                            if (p == 2 ){
                                twoCount = true
                            } else if (p == 5){
                                fiveCount = true
                            }
                            return true
                        } else {
                            return false
                        }
                    } else if (p == dropNum || span == dropSha || p == 20) {
                        if(p == 2){
                            twoCount = true
                        } else if (p == 5 ){
                            fiveCount = true
                        }
                        return true
                    } else {
                        return false
                    }
                }

                function twenty() {
                    $('#twenty').css('visibility', 'visible')
                    $('.a').on('click', function(){
                        whotShape = $(this).attr('id')
                        $('#twenty').css('visibility', 'hidden')
                        passTurn()
                    })

                }

                $('#market').on('click', function(){
                    if ($('#droppable').find('p').text() == 2 && twoCount == true) {
                        dashCards(2,  1)
                        // $('h2').text(mes[3] + 2 + ' cards. You can play now')
                        twoCount = false
                        passTurn()
                    }else if ($('#droppable').find('p').text() == 5 && fiveCount == true ) {
                        dashCards(3 , 1)
                        $('h2').text(mes[4] + 3 + ' cards. You can play now')
                        fiveCount = false
                        passTurn()
                    } else {
                        dashCards(1, 1)
                        $('h2').text(mes[2])
                        passTurn()
                    }
                })

            function passTurn() {
                if (currentPlayer == 1) {
                    currentPlayer = 0
                    setTimeout(function () {
                        control()
                    }, 1000)
                } else {
                    currentPlayer = 1
                    control()
                }

            }

            var mes = ["Player 1's turn", "Computer is playing", "You picked a card", "You Picked ", "You picked ", "Computer picked a card", "computer picked ", "Computer picked ", "General market for you", "LAST CARD", "Computer picked a card" ]

            function control() {
                if (currentPlayer == 0) {
                    $('h2').text(mes[1])
                    setTimeout(function(){
                        comp()
                    }, 1000)
                } else {
                    setTimeout(function () {
                        $('h2').text(mes[0])
                    }, 1000)
                }
            }

            var compcard;
            function comp() {
                var p =  $('#droppable').find('p').text()
                var span  = $('#droppable').find('span').text()

                var x = false

                for (let i = 0; i < computerCAS.length; i++) {
                    var presentNum = computerCAS[i]['number']
                    var presentSha = computerCAS[i]['shape']
                    // console.log(presentSha + ' ' + span)


                    if(p == presentNum || span == presentSha || presentNum == 20 || (p == 20 && presentSha == whotShape)){
                        x = true
                        // console.log('a')
                        var y = dropCheck(presentNum, presentSha)
                        if(y == true){
                            // alert(true)
                            $('.ndraggable').each(function () {
                                if($(this).find('p').text() == presentNum && $(this).find('span').text() == presentSha){
                                    compCard = $(this)
                                    setTimeout(function () {
                                        compCard.children().css('visibility', 'visible')
                                        setTimeout(function(){
                                            $('#droppable').html(compCard.html())
                                            var obj = {
                                                number: presentNum,
                                                shape: presentSha
                                            }
                                            played.push(obj)
                                            compCard.css('display', 'none')

                                            if (presentNum == 2) {
                                                passTurn()
                                            } else if (presentNum == 5) {
                                                passTurn()
                                            } else if (presentNum == 14) {
                                                twoCount = false
                                                fiveCount = false
                                                currentPlayer = 1
                                                dashCards(1, 1)
                                                $('h2').text(mes[8])
                                                passTurn()
                                            } else if (presentNum == 8) {
                                                twoCount = false
                                                fiveCount = false
                                                currentPlayer = 1
                                                passTurn()
                                            } else if (presentNum == 20) {
                                                twoCount = false
                                                fiveCount = false
                                                compTwenty()
                                                passTurn()
                                            } else {
                                                twoCount = false
                                                fiveCount = false
                                                passTurn()
                                            }
                                            computerCAS.splice(i, 1)
                                            if (computerCAS.length == 1){
                                                $('h2').text(mes[9])
                                            }
                                            return false
                                        }, 1000)
                                    }, 1000)

                                }
                            })
                            break
                        } else {
                            if (p == 2 && twoCount == true) {
                                setTimeout(function(){
                                    dashCards(2, currentPlayer)
                                    $('h2').text(mes[6] + 2 + ' cards')
                                    setTimeout(function () {
                                        twoCount = false
                                        passTurn()
                                    }, 1000)
                                }, 1000)
                            } else if (p == 5 && fiveCount == true){
                                setTimeout(function(){
                                    dashCards(3 , currentPlayer)
                                    $('h2').text(mes[7] + 3 + ' cards')
                                    setTimeout(function () {
                                        fiveCount = false
                                        passTurn()
                                    }, 1000)
                                },  1000)
                            } else {
                                setTimeout(function(){
                                    dashCards(1, currentPlayer)
                                    $('h2').text(mes[5])
                                    setTimeout(function () {
                                    passTurn()
                                    }, 1000)
                                }, 1000)
                            }
                        }
                        break
                    }
                }

                if (!x){
                    if (p == 2 && twoCount ==true){
                        dashCards(2 , currentPlayer)
                        $('h2').text(mes[6] + 2 + ' cards')
                        setTimeout(function () {
                            twoCount = false
                            control()
                        }, 1000)

                    } else if (p == 5 && fiveCount == true){
                        dashCards(3 , currentPlayer)
                        $('h2').text(mes[7] + 3  + ' cards')
                        setTimeout(function () {
                            fiveCount = false
                            control()
                        }, 1000)

                    } else {
                        setTimeout(function(){
                        dashCards(1, currentPlayer)
                        $('h2').text(mes[5])
                        setTimeout(function () {
                            passTurn()
                        }, 1000)
                    }, 1000)
                    }
                }
            }

            function compTwenty() {
                console.log('step 3')
                var myShape = ['square', 'circle', 'cross', 'triangle', 'star']
                var random = Math.floor(Math.random() * 5)
                whotShape = myShape[random]
                setTimeout(function () {
                    $('h2').text('computer picked ' + whotShape)
                    return
                }, 2000)
            }

            console.log(computerCAS)
        })
        </script>
    </body>
</html>