<!DOCTYPE html>
<html>
    <head>
        <title>CARDS</title>
        <link rel="stylesheet" href="styles.css">
        <link rel="stylesheet" href="../eReceipt/jquery-ui-1.12.1/jquery-ui.min.css">
        <link rel="stylesheet" href="../eReceipt/jquery-ui-1.12.1/jquery-ui.structure.min.css">
        <link rel="stylesheet" href="../eReceipt/jquery-ui-1.12.1/jquery-ui.theme.min.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    </head>
    <body>
        <div id="computer" class="clearfix">
            <!-- <div style="height: 250px; width: 200px; background-color: wheat; position: relative; margin-bottom: 5px;">
            <p style="color:#521717; font-weight: bolder; font-size: xx-large;">12</p>
            <span>square</span>
            <div style="position: absolute; top: 33px; left: 7px; " > <i class="fas fa-cross" style="font-size: 20px; color:#521717;  "></i></div>
            <div  style="position: absolute; top: 70px; left: 50px; " > <i class="fas fa-cross" style="font-size: 100px; color:#521717;  "></i></div>
            <div style="position: absolute; bottom: 4px; right: 4px; " > <i class="fas fa-cross" style="font-size: 20px; color:#521717;  "></i></div>
        </div> -->
        </div>


        <div id="center" class="clearfix">
            <div id="market" ><p></p>  <span>whot</span></div>

        </div>

        <div id="player">

        </div>
        <script src="../eReceipt/jquery-3.5.1.min.js"></script>
        <script src="../eReceipt/jquery-ui-1.12.1/jquery-ui.min.js"></script>
        <script>
            $(function () {

                // available card contains the number of cards available in the deck of card at any specific time
                var availableCard = [
                        {
                            number: 1,
                            shape: "circle"
                        },
                        {
                            number: 1,
                            shape: "triangle"
                        },
                        {
                            number: 1,
                            shape: "cross"
                        },
                        {
                            number: 1,
                            shape: "square"
                        },
                        {
                            number: 1,
                            shape: "star"
                        },
                        {
                            number: 2,
                            shape: "circle"
                        },
                        {
                            number: 2,
                            shape: "triangle"
                        },
                        {
                            number: 2,
                            shape: "cross"
                        },
                        {
                            number: 2,
                            shape: "square"
                        },
                        {
                            number: 2,
                            shape: "star"
                        },
                        {
                            number: 3,
                            shape: "circle"
                        },
                        {
                            number: 3,
                            shape: "triangle"
                        },
                        {
                            number: 3,
                            shape: "cross"
                        },
                        {
                            number: 3,
                            shape: "square"
                        },
                        {
                            number: 3,
                            shape: "star"
                        },
                        {
                            number: 4,
                            shape: "circle"
                        },
                        {
                            number: 4,
                            shape: "triangle"
                        },
                        {
                            number: 4,
                            shape: "star"
                        },
                        {
                            number: 5,
                            shape: "circle"
                        },
                        {
                            number: 5,
                            shape: "triangle"
                        },
                        {
                            number: 5,
                            shape: "cross"
                        },
                        {
                            number: 5,
                            shape: "square"
                        },
                        {
                            number: 5,
                            shape: "star"
                        },
                        {
                            number: 7,
                            shape: "circle"
                        },
                        {
                            number: 7,
                            shape: "triangle"
                        },
                        {
                            number: 7,
                            shape: "cross"
                        },
                        {
                            number: 7,
                            shape: "square"
                        },
                        {
                            number: 7,
                            shape: "star"
                        },
                        {
                            number: 8,
                            shape: "circle"
                        },
                        {
                            number: 8,
                            shape: "triangle"
                        },
                        {
                            number: 8,
                            shape: "star"
                        },
                        {
                            number: 10,
                            shape: "circle"
                        },
                        {
                            number: 10,
                            shape: "triangle"
                        },
                        {
                            number: 10,
                            shape: "cross"
                        },
                        {
                            number: 10,
                            shape: "square"
                        },
                        {
                            number: 11,
                            shape: "circle"
                        },
                        {
                            number: 11,
                            shape: "triangle"
                        },
                        {
                            number: 11,
                            shape: "cross"
                        },
                        {
                            number: 11,
                            shape: "square"
                        },
                        {
                            number: 12,
                            shape: "circle"
                        },
                        {
                            number: 12,
                            shape: "triangle"
                        },
                        {
                            number: 13,
                            shape: "circle"
                        },
                        {
                            number: 13,
                            shape: "triangle"
                        },
                        {
                            number: 13,
                            shape: "cross"
                        },
                        {
                            number: 13,
                            shape: "square"
                        },
                        {
                            number: 14,
                            shape: "circle"
                        },
                        {
                            number: 14,
                            shape: "triangle"
                        },
                        {
                            number: 14,
                            shape: "cross"
                        },
                        {
                            number: 14,
                            shape: "square"
                        },
                        {
                            number: 20,
                            shape: "whot"
                        },
                        {
                            number: 20,
                            shape: "whot"
                        },
                        {
                            number: 20,
                            shape: "whot"
                        },
                        {
                            number: 20,
                            shape: "whot"
                        }
                    ]

            // cardDeck always contains the number of card in a complete card deck
                var cardDeck = [
                        {
                            number: 1,
                            shape: "circle"
                        },
                        {
                            number: 1,
                            shape: "triangle"
                        },
                        {
                            number: 1,
                            shape: "cross"
                        },
                        {
                            number: 1,
                            shape: "square"
                        },
                        {
                            number: 1,
                            shape: "star"
                        },
                        {
                            number: 2,
                            shape: "circle"
                        },
                        {
                            number: 2,
                            shape: "triangle"
                        },
                        {
                            number: 2,
                            shape: "cross"
                        },
                        {
                            number: 2,
                            shape: "square"
                        },
                        {
                            number: 2,
                            shape: "star"
                        },
                        {
                            number: 3,
                            shape: "circle"
                        },
                        {
                            number: 3,
                            shape: "triangle"
                        },
                        {
                            number: 3,
                            shape: "cross"
                        },
                        {
                            number: 3,
                            shape: "square"
                        },
                        {
                            number: 3,
                            shape: "star"
                        },
                        {
                            number: 4,
                            shape: "circle"
                        },
                        {
                            number: 4,
                            shape: "triangle"
                        },
                        {
                            number: 4,
                            shape: "star"
                        },
                        {
                            number: 5,
                            shape: "circle"
                        },
                        {
                            number: 5,
                            shape: "triangle"
                        },
                        {
                            number: 5,
                            shape: "cross"
                        },
                        {
                            number: 5,
                            shape: "square"
                        },
                        {
                            number: 5,
                            shape: "star"
                        },
                        {
                            number: 7,
                            shape: "circle"
                        },
                        {
                            number: 7,
                            shape: "triangle"
                        },
                        {
                            number: 7,
                            shape: "cross"
                        },
                        {
                            number: 7,
                            shape: "square"
                        },
                        {
                            number: 7,
                            shape: "star"
                        },
                        {
                            number: 8,
                            shape: "circle"
                        },
                        {
                            number: 8,
                            shape: "triangle"
                        },
                        {
                            number: 8,
                            shape: "star"
                        },
                        {
                            number: 10,
                            shape: "circle"
                        },
                        {
                            number: 10,
                            shape: "triangle"
                        },
                        {
                            number: 10,
                            shape: "cross"
                        },
                        {
                            number: 10,
                            shape: "square"
                        },
                        {
                            number: 11,
                            shape: "circle"
                        },
                        {
                            number: 11,
                            shape: "triangle"
                        },
                        {
                            number: 11,
                            shape: "cross"
                        },
                        {
                            number: 11,
                            shape: "square"
                        },
                        {
                            number: 12,
                            shape: "circle"
                        },
                        {
                            number: 12,
                            shape: "triangle"
                        },
                        {
                            number: 13,
                            shape: "circle"
                        },
                        {
                            number: 13,
                            shape: "triangle"
                        },
                        {
                            number: 13,
                            shape: "cross"
                        },
                        {
                            number: 13,
                            shape: "square"
                        },
                        {
                            number: 14,
                            shape: "circle"
                        },
                        {
                            number: 14,
                            shape: "triangle"
                        },
                        {
                            number: 14,
                            shape: "cross"
                        },
                        {
                            number: 14,
                            shape: "square"
                        },
                        {
                            number: 20,
                            shape: "whot"
                        },
                        {
                            number: 20,
                            shape: "whot"
                        },
                        {
                            number: 20,
                            shape: "whot"
                        },
                        {
                            number: 20,
                            shape: "whot"
                        }
                ]

                var fourteen;
                // computerCAS is an array the contins the computer's present card ({number , shape})
                var computerCAS = []

                // curentPlayer (o for computer, 1 for player1)
                var currentPlayer;

                // fiveCount heeps the record of how many number 5 cards are played consequtively
                var fiveCount = 0;
                // twoCount heeps the record of how many number 2 cards are played consequtively
                var twoCount = 0;

                var played = []

                // The control function passes control to either the computer when necessary

                // On ready of the document, a random current player is selected beetween the player and the computer
                function control() {
                    if (currentPlayer == undefined) {
                        currentPlayer = Math.floor(Math.random() * 2)
                    }


                    if (currentPlayer == 0) {
                        console.log('computer plays')
                        var x = comp()

                        // ON returning false from the comp function, it meand the computer has no card to play

                        // The the conputer either picks two cards or five cards (and the control function is called again to pass control to the computer) depending on what is on the #droppable at the point
                        //  If neither 2 or 5 is is on the #droppable, the the computer picks a card and the passturn function is called to
                        // pass the play to the next player
                        if (!x) {
                            if ($('#droppable').find('p').text() == 2 && twoCount != 0){
                                dashCards(2, currentPlayer)
                                twoCount = 0
                                control()
                            } else if ($('#droppable').find('p').text() == 5 && fiveCount != 0) {
                                dashCards(3, currentPlayer)
                                fiveCount = 0
                                control()
                            } else {
                                setTimeout(function(){
                                pick(0)
                                console.log('computer has' + computerCAS.length + 'cards')
                                passturn()
                            }, 1000)
                            }
                        } else {
                            // if the comp function returns true, then the computer has played successfully and the passturn function is called to change the current player

                            passturn()



                        }
                    } else {
                            // if currentPlayer!= 0 then the next player is alerted to play

                                console.log('player1 plays')

                    }
                }


                // 5 cards are dashed out to both players in the game and 1 vard is placed in the #droppable
                dashCards(5, 0)
                dashCards(5, 1)
                dashCards(1, 3)

                // The dashCards functions calls on the pick function 'number' number of times to dash out cards to a particulay player
                function dashCards(number, player) {
                    for (i = 0; i<number; i++){
                        pick(player)
                    }
                }


                $('.draggable').draggable({
                    revert: true
                })

                // The rules function receives a particular element and checks if it a 2, or 5  and compares it to the #droppable card to dash out cards if necessary
                function rules(toDrop) {
                    // alert()
                    if((toDrop).find('p').text() != 2 && $('#droppable').find('p').text() == 2 && twoCount != 0){
                        alert('1')
                        dashCards(2, currentPlayer)
                        twoCount  = 0
                    } else if ((toDrop).find('p').text() != 5 && $('#droppable').find('p').text() == 5 && fiveCount != 0) {
                        alert('2')
                        dashCards(3, currentPlayer)
                        fiveCount = 0
                    } else if ((toDrop).find('p').text() == 8){
                        currentPlayer == 0 ? currentPlayer = 1 : currentPlayer = 0
                    }

                }

                // playerCard is a global variable that holds the current card being played by the current player dragging this card
                var playerCard;
                $('#droppable').droppable(
                    {
                        drop: function (event, ui) {
                            var content = $(ui.draggable).find('p').text()
                            var scontent = $(ui.draggable).find('span').text()
                            var current = $(this).find('p').text()
                            var scurrent = $(this).find('span').text()

                            // checks to see if the card dragged can be dropped on the droppable
                            // also increases the twoCount and fiveCount when necessary
                            if (content == current || scurrent == scontent || content == 20 || current == 20) {
                                playerCard =  $(ui.draggable)
                                $(ui.draggable).css("display", "none")
                                rules(playerCard)
                                $('#droppable').html($(ui.draggable.html()))

                                var play1 = {
                                    number: content,
                                    shape: scontent
                                }
                                played.push(play1)
                                if ($(playerCard).find('p').text() == 2){
                                    twoCount++
                                    console.log(twoCount + 'twoCount')
                                } else if ($(playerCard).find('p').text() == 5) {
                                    fiveCount++
                                    console.log(fiveCount + 'fiveCount')
                                } else if ($(playerCard).find('p').text() == 8) {
                                    currentPlayer = 0
                                }
                                console.log(twoCount + ' fiveCount' + fiveCount)
                                setTimeout(function () {
                                    passturn()
                                }, 1000)


                            } else {
                                // if the card does not correspond then the card reverts to its position
                                $(ui.draggable).draggable("option", "revert", true)
                            }
                        }
                    }

                )

                    // On click on the market, 1 card is dashed for normal pick,  2 if 2 is on the droppable and 3 if 5 is on the droppable
                    $('#market').on('click', function () {
                        if ($('#droppable').find('p').text() == 2 && twoCount != 0){
                                dashCards(2, currentPlayer)
                                twoCount = 0
                        } else if ($('#droppable').find('p').text() == 5 && fiveCount != 0) {
                            dashCards(3, currentPlayer)
                            fiveCount = 0
                        } else {
                            pick(1)
                            passturn()
                        }
                    })

                    // function fillMarket(){

                    // }

                    //The pick function takes in as input the currentPlayer

                    function pick(n) {
                        if (availableCard.length == 0) {
                            availableCard = played
                            played = []
                        } else {
                            var r =  Math.floor(Math.random() * availableCard.length)
                            render(r, n)
                        }

                    }

                    // The render function takes in the index number of the random generated number and the currentPlayer and display cards for each player
                    function render(re, z) {
                        if (availableCard[re] == undefined) {
                            console.log(availableCard[re])
                            pick(n)
                        } else {
                            let cardNum = availableCard[re]['number']
                            let cardShape = availableCard[re]['shape']
                            var div;
                            var x ;
                            var s = 'fas fa-square'
                            var t = 'fas fa-play'
                            var c = 'fas fa-circle'
                            var st = 'fas fa-star'
                            var w = 'fas fa-whot'
                            var cr = 'fas fa-cross'
                            var shapes;

                            if (cardShape == 'square'){
                                shapes = s
                            }else if (cardShape == 'triangle'){
                                shapes = t
                            }else if (cardShape == 'circle'){
                                shapes = c
                            }else if (cardShape == 'star'){
                                shapes = st
                            }else if (cardShape == 'cross'){
                                shapes = cr
                            } else {
                                shapes = w
                            }


                            if (z == 0) {
                                x = '#computer'
                                computerCAS.push(availableCard[re])
                                div =
                                // `<div class="draggable"><p>${cardNum}</p>  <span>${cardShape}</span></div>`


                                `<div class="draggable" style="height: 250px; width: 200px; background-color: wheat; position: relative;"><p style="color:#521717; font-weight: bolder; font-size: xx-large;">${cardNum}</p><span>${cardShape}</span><div style="position: absolute; top: 33px; left: 7px; " > <i class="${shapes}" style="font-size: 20px; color:#521717;"></i></div><div  style="position: absolute; top: 70px; left: 50px; " > <i class="${shapes}" style="font-size: 100px; color:#521717;  "></i></div><div style="position: absolute; bottom: 4px; right: 4px; " > <i class="${shapes}" style="font-size: 20px; color:#521717;"></i></div></div>`
                            } else if (z == 1) {
                                x = '#player'
                                div =

                                //  `<div class="draggable"><p>${cardNum}</p>  <span>${cardShape}</span></div>`

                                    `<div class="draggable" style="height: 250px; width: 200px; background-color: wheat; position: relative;"><p style="color:#521717; font-weight: bolder; font-size: xx-large;">${cardNum}</p><span>${cardShape}</span><div style="position: absolute; top: 33px; left: 7px; " > <i class="${shapes}" style="font-size: 20px; color:#521717;"></i></div><div  style="position: absolute; top: 70px; left: 50px; " > <i class="${shapes}" style="font-size: 100px; color:#521717;  "></i></div><div style="position: absolute; bottom: 32px; right: 12px; " > <i class="${shapes}" style="font-size: 20px; color:#521717; "></i></div></div>`
                            } else {
                                x = '#center'
                                div =

                                //  `<div id="droppable"><p>${cardNum}</p>  <span>${cardShape}</span></div>`

                                        `<div id="droppable" style="height: 250px; width: 200px; background-color: wheat; position: relative;"><p style="color:#521717; font-weight: bolder; font-size: xx-large;">${cardNum}</p><span>${cardShape}</span><div style="position: absolute; top: 33px; left: 7px; " > <i class="${shapes}" style="font-size: 20px; color:#521717;"></i></div><div  style="position: absolute; top: 70px; left: 50px; " > <i class="${shapes}" style="font-size: 100px; color:#521717;  "></i></div><div style="position: absolute; bottom: 32px; right: 12px; " > <i class="${shapes}" style="font-size: 20px; color:#521717; "></i></div></div>`
                            }
                            $(x).append(div)

                            $('.draggable').draggable({
                                revert: true
                            })
                            availableCard.splice(re, 1)
                        }
                    }


                    var compCard;
                    var a;

                    // The comp function checks the array of the computerCAS for the first apperance of playable card
                    // if none is found, a false is returned to the control function
                    function comp() {
                        var p = false
                        for (let index = 0; index < computerCAS.length; index++) {
                            let currentNum = $('#droppable').find('p').text()
                            let currentSha = $('#droppable').find('span').text()
                            let presentNum = computerCAS[index]['number']
                            let presentSha = computerCAS[index]['shape']
                            if (currentNum == presentNum || currentSha == presentSha || currentNum == 20 || presentNum == 20 ) {
                                $('#computer .draggable').each(function () {
                                    if($(this).find('p').text() == presentNum && $(this).find('span').text() == presentSha  ){

                                        compCard = $(this)
                                        var play2 = {
                                            number: presentNum,
                                            shape: presentSha
                                        }
                                        played.push(play2)
                                         rules(compCard)

                                        if (compCard.find('p').text() == 2) {
                                            twoCount++
                                            console.log(twoCount + 'twoCount')
                                        } else if (compCard.find('p').text() == 5){
                                            fiveCount++
                                            console.log(fiveCount + 'fiveCount')
                                        }

                                        setTimeout(function(){


                                            compCard.children().css('visibility', 'visible')

                                            setTimeout(function () {





                                                $(compCard).css('visibility', 'visible')

                                                compCard.children().css('visiblility', 'hidden')


                                                setTimeout(function(){
                                                $('#droppable').html(compCard.html())


                                                compCard.css('display', 'none')



                                                computerCAS.splice(index, 1)
                                                return false
                                                }, 1000)

                                            }, 1000)
                                        }, 1000)
                                    }
                                    p = true
                                })
                                break
                            }

                        }
                        return p;
                    }

                    function passturn() {
                        if (currentPlayer == 0) {
                            currentPlayer = 1
                        }
                         else {
                           currentPlayer = 0
                        }


                        control()
                    }


                    control()
            })


        </script>
    </body>
</html>